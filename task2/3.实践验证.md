# 三、实践验证：Geth 节点部署与操作

## 1. 编译并运行 Geth 节点

```bash
# 克隆源码仓库
git clone https://github.com/ethereum/go-ethereum.git
cd go-ethereum

# 编译Geth
make geth

# 查看版本信息
./build/bin/geth version

# 启动开发模式节点
./build/bin/geth --dev --http --http.addr 0.0.0.0 --http.api eth,net,web3,personal --allow-insecure-unlock
```

## 2. 私有链搭建过程

### 步骤 1：创建创世区块配置文件

创建`genesis.json`文件：

```json
{
  "config": {
    "chainId": 15,
    "homesteadBlock": 0,
    "eip150Block": 0,
    "eip155Block": 0,
    "eip158Block": 0,
    "byzantiumBlock": 0,
    "constantinopleBlock": 0,
    "petersburgBlock": 0,
    "istanbulBlock": 0
  },
  "alloc": {},
  "coinbase": "0x0000000000000000000000000000000000000000",
  "difficulty": "0x20000",
  "extraData": "",
  "gasLimit": "0x2fefd8",
  "nonce": "0x0000000000000042",
  "mixhash": "0x0000000000000000000000000000000000000000000000000000000000000000",
  "parentHash": "0x0000000000000000000000000000000000000000000000000000000000000000",
  "timestamp": "0x00"
}
```

### 步骤 2：初始化私有链

```bash
# 创建数据目录
mkdir -p ./privatechain/data

# 初始化区块链
./build/bin/geth init ./genesis.json --datadir ./privatechain/data
```

### 步骤 3：启动私有链节点

```bash
./build/bin/geth --datadir ./privatechain/data \
  --networkid 15 \
  --http --http.addr 0.0.0.0 \
  --http.port 8545 \
  --http.api eth,net,web3,personal,miner \
  --allow-insecure-unlock \
  --nodiscover
```

### 步骤 4：连接到节点控制台

```bash
./build/bin/geth attach http://localhost:8545
```

## 3. 控制台基本操作

```javascript
// 查看区块高度
eth.blockNumber

// 创建新账户
personal.newAccount("password")

// 查看账户列表
eth.accounts

// 启动挖矿（开发模式）
miner.start(1)

// 等待区块生成后停止挖矿
miner.stop()

// 查看账户余额
eth.getBalance(eth.accounts[0])

// 解锁账户
personal.unlockAccount(eth.accounts[0], "password", 300)

// 发送交易
eth.sendTransaction({from: eth.accounts[0], to: eth.accounts[1], value: web3.toWei(1, "ether")})
```

## 4. 智能合约部署与交互

使用 Remix IDE 编写简单存储合约：

```solidity
pragma solidity ^0.8.0;

contract SimpleStorage {
    uint256 private _value;
    
    function setValue(uint256 value) public {
        _value = value;
    }
    
    function getValue() public view returns (uint256) {
        return _value;
    }
}
```

编译合约后，通过 Web3 provider 连接到本地节点，部署合约并交互：

```javascript
// 在Geth控制台部署合约
var abi = [...]; // 合约ABI
var bytecode = "0x..."; // 合约字节码

var simpleStorageContract = web3.eth.contract(abi);
var simpleStorage = simpleStorageContract.new(
   {
     from: eth.accounts[0], 
     data: bytecode, 
     gas: '4700000'
   }, 
   function (e, contract){
    console.log(e, contract);
    if (typeof contract.address !== 'undefined') {
         console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
    }
 })

// 调用合约方法
simpleStorage.setValue(42, {from: eth.accounts[0]})
simpleStorage.getValue.call() // 应返回42
```

## 5. 区块浏览器查询

1. 安装并启动以太坊区块浏览器（如 Etherscan 私有链版本或 EthStats）
2. 配置浏览器连接到私有链节点
3. 查询刚才部署的合约地址和交易哈希
4. 验证合约代码和交易详情是否正确显示